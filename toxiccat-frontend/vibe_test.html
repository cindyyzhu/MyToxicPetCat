<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Toxic Pet Cat</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #1a0a2e;
            --bg-mid: #2d1b4e;
            --accent-pink: #ff6b9d;
            --accent-cyan: #00d9ff;
            --accent-yellow: #ffd93d;
            --text-light: #f0f0f0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'VT323', monospace;
            background: linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-mid) 100%);
            color: var(--text-light);
            overflow: hidden;
            height: 100vh;
            position: relative;
        }

        /* Scanline effect */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.15),
                rgba(0, 0, 0, 0.15) 1px,
                transparent 1px,
                transparent 2px
            );
            pointer-events: none;
            z-index: 1000;
            animation: scanline 8s linear infinite;
        }

        @keyframes scanline {
            0% { transform: translateY(0); }
            100% { transform: translateY(100px); }
        }

        /* Floating particles */
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--accent-cyan);
            opacity: 0.3;
            animation: float 15s infinite ease-in-out;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) translateX(0); }
            50% { transform: translateY(-100vh) translateX(50px); }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 1;
        }

        .header {
            font-family: 'Press Start 2P', monospace;
            font-size: 24px;
            text-align: center;
            margin-bottom: 20px;
            color: var(--accent-pink);
            text-shadow: 
                0 0 10px var(--accent-pink),
                0 0 20px var(--accent-pink),
                0 0 30px var(--accent-cyan);
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { text-shadow: 0 0 10px var(--accent-pink), 0 0 20px var(--accent-pink); }
            to { text-shadow: 0 0 20px var(--accent-pink), 0 0 30px var(--accent-pink), 0 0 40px var(--accent-cyan); }
        }

        .main-content {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            align-items: center;
        }

        .cat-display {
            background: rgba(0, 0, 0, 0.4);
            border: 4px solid var(--accent-cyan);
            box-shadow: 
                0 0 20px rgba(0, 217, 255, 0.3),
                inset 0 0 20px rgba(0, 0, 0, 0.5);
            padding: 40px;
            border-radius: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
            min-height: 400px;
        }

        .cat-display::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(135deg, var(--accent-pink), var(--accent-cyan));
            border-radius: 20px;
            z-index: -1;
        }

        .cat-image-container {
            position: relative;
            width: 100%;
            height: 400px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .cat-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            animation: catBounce 3s ease-in-out infinite;
            transition: opacity 0.3s ease;
        }

        .cat-video {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            animation: catBounce 3s ease-in-out infinite;
            transition: opacity 0.3s ease;
        }

        .cat-image.hidden,
        .cat-video.hidden {
            opacity: 0;
            position: absolute;
        }

        @keyframes catBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .info-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .speech-box {
            background: rgba(0, 0, 0, 0.6);
            border: 3px solid var(--accent-yellow);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 0 15px rgba(255, 217, 61, 0.3);
        }

        .speech-box h2 {
            font-family: 'Press Start 2P', monospace;
            font-size: 14px;
            color: var(--accent-yellow);
            margin-bottom: 15px;
            text-transform: uppercase;
        }

        .speech-text {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            min-height: 150px;
            font-size: 22px;
            line-height: 1.5;
            border-left: 4px solid var(--accent-pink);
            animation: fadeIn 0.5s ease-in;
            font-family: 'Courier New', monospace;
        }

        /* Terminal cursor */
        .speech-text::after {
            content: '‚ñà';
            color: var(--accent-cyan);
            animation: blink 1s step-end infinite;
            margin-left: 2px;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .mood-indicator {
            margin-top: 15px;
            font-family: 'Press Start 2P', monospace;
            font-size: 12px;
            text-align: center;
            color: var(--accent-cyan);
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .version-info {
            position: absolute;
            bottom: 10px;
            right: 10px;
            font-family: 'Press Start 2P', monospace;
            font-size: 8px;
            color: rgba(255, 255, 255, 0.3);
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            .header {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <!-- Floating particles -->
    <div class="particle" style="left: 10%; animation-delay: 0s;"></div>
    <div class="particle" style="left: 30%; animation-delay: 2s;"></div>
    <div class="particle" style="left: 50%; animation-delay: 4s;"></div>
    <div class="particle" style="left: 70%; animation-delay: 6s;"></div>
    <div class="particle" style="left: 90%; animation-delay: 8s;"></div>

    <div class="container">
        <div class="header">
            ‚ü®‚ü® MY TOXIC PET CAT ‚ü©‚ü©
        </div>

        <div class="main-content">
            <div class="cat-display">
                <div class="cat-image-container" id="catImageContainer">
                    <!-- Cat images/videos will be dynamically loaded here -->
                    <!-- Supports: PNG, JPG, GIF, MP4, WEBM -->
                </div>
            </div>

            <div class="info-panel">
                <div class="speech-box">
                    <h2>üí¨ Response</h2>
                    <div class="speech-text" id="speechText">
                        
                    </div>
                    <div class="mood-indicator" id="moodIndicator">
                        Current Mood: IDLE
                    </div>
                </div>
            </div>
        </div>

        <div class="version-info">v2.0.0 | Pi-CatBot Custom</div>
    </div>

    <script>
        let currentMood = 'idle';
        
        // Asset paths - using single GIF for responding state
        const assetPaths = {
            idle: 'assets/cat-idle.gif',              // Still image when idle
            responding: 'assets/cat-responding.gif',   // GIF when responding/active
        };

        // Detect file type based on extension
        function getFileType(path) {
            const ext = path.split('.').pop().toLowerCase();
            if (ext === 'mp4' || ext === 'webm' || ext === 'mov') {
                return 'video';
            }
            return 'image'; // png, jpg, gif, webp, svg
        }

        // Create and load assets dynamically
        function createAssetElement(mood, path) {
            const container = document.getElementById('catImageContainer');
            const fileType = getFileType(path);
            let element;

            if (fileType === 'video') {
                element = document.createElement('video');
                element.className = 'cat-video hidden';
                element.loop = true;
                element.muted = true;
                element.playsInline = true;
                element.autoplay = false;
                element.src = path;
            } else {
                element = document.createElement('img');
                element.className = 'cat-image hidden';
                element.src = path;
                element.alt = `${mood} Cat`;
            }

            element.id = `catAsset-${mood}`;
            element.dataset.mood = mood;
            element.dataset.type = fileType;

            // Error handling
            element.onerror = function() {
                console.error(`Failed to load asset for ${mood}: ${path}`);
                this.style.display = 'none';
            };

            // Success handling
            if (fileType === 'image') {
                element.onload = function() {
                    console.log(`‚úÖ Loaded ${mood} image: ${path}`);
                };
            } else {
                element.onloadeddata = function() {
                    console.log(`‚úÖ Loaded ${mood} video: ${path}`);
                };
            }

            container.appendChild(element);
            return element;
        }

        // Load all assets on page load
        window.addEventListener('DOMContentLoaded', () => {
            const container = document.getElementById('catImageContainer');
            container.innerHTML = ''; // Clear container

            console.log('üé¨ Loading assets...');

            // Create elements for all moods
            for (const [mood, path] of Object.entries(assetPaths)) {
                createAssetElement(mood, path);
            }

            // Clear speech box initially
            document.getElementById('speechText').textContent = '';
            console.log('üßπ Cleared speech box on load');

            // Show idle by default
            setTimeout(() => {
                const idleElement = document.getElementById('catAsset-idle');
                if (idleElement) {
                    idleElement.classList.remove('hidden');
                    console.log('üê± Starting in IDLE state');
                    if (idleElement.tagName === 'VIDEO') {
                        idleElement.play().catch(e => console.log('Video autoplay prevented'));
                    }
                } else {
                    console.error('‚ùå Could not find idle asset!');
                }

                // Start test mode after a brief delay
                setTimeout(() => {
                    console.log('üöÄ Test mode starting - will switch to RESPONDING in 1 second...');
                    toggleResponse(); // Trigger first switch to responding
                }, 1000);
            }, 100);
        });

        // Change mood and switch displayed image/video
        function changeMood(mood) {
            console.log(`üîÑ Changing mood to: ${mood}`);
            currentMood = mood;
            
            // Get all cat assets (images and videos)
            const allAssets = document.querySelectorAll('.cat-image, .cat-video');
            console.log(`   Found ${allAssets.length} total assets`);
            
            // Hide all and pause videos
            allAssets.forEach(asset => {
                asset.classList.add('hidden');
                if (asset.tagName === 'VIDEO') {
                    asset.pause();
                    asset.currentTime = 0; // Reset video to start
                }
            });
            
            // Show and play the selected mood
            const targetAsset = document.getElementById(`catAsset-${mood}`);
            if (targetAsset) {
                console.log(`   ‚úÖ Found asset for ${mood}, type: ${targetAsset.tagName}`);
                targetAsset.classList.remove('hidden');
                
                // If it's a video, play it
                if (targetAsset.tagName === 'VIDEO') {
                    targetAsset.play().catch(e => {
                        console.error('   ‚ùå Video play failed:', e);
                    });
                }
            } else {
                console.error(`   ‚ùå No asset found for mood: ${mood}`);
                console.log(`   Available assets:`, Array.from(allAssets).map(a => a.id));
            }
            
            const moodText = {
                responding: 'RESPONDING',
                idle: 'IDLE'
            };
            
            document.getElementById('moodIndicator').textContent = `Current Mood: ${moodText[mood] || 'UNKNOWN'}`;
            
            // Handle speech box based on mood
            if (mood === 'responding') {
                // Start typing animation
                typeText('AHAHAHA', 150); // 150ms per character
            } else if (mood === 'idle') {
                // Clear speech box when going idle
                clearSpeechBox();
            }
        }

        // Update speech text
        function updateSpeech(text) {
            const speechElement = document.getElementById('speechText');
            speechElement.style.animation = 'none';
            setTimeout(() => {
                speechElement.textContent = text;
                speechElement.style.animation = 'fadeIn 0.5s ease-in';
            }, 10);
        }

        // Terminal typing animation
        let typingInterval = null;

        function typeText(text, speed = 100) {
            const speechElement = document.getElementById('speechText');
            
            console.log(`‚å®Ô∏è  typeText() called with: "${text}", speed: ${speed}ms`);
            console.log(`   Speech element found:`, speechElement ? 'YES' : 'NO');
            
            // Clear any existing typing animation
            if (typingInterval) {
                console.log(`   Clearing existing typing interval`);
                clearInterval(typingInterval);
                typingInterval = null;
            }

            // Clear the text box
            speechElement.textContent = '';
            console.log(`   Cleared text box, starting to type...`);
            
            let index = 0;
            
            typingInterval = setInterval(() => {
                if (index < text.length) {
                    speechElement.textContent += text[index];
                    console.log(`   Typed character ${index + 1}/${text.length}: "${text[index]}" - Current text: "${speechElement.textContent}"`);
                    index++;
                } else {
                    clearInterval(typingInterval);
                    typingInterval = null;
                    console.log(`‚úÖ Finished typing complete text: "${speechElement.textContent}"`);
                }
            }, speed);
        }

        function clearSpeechBox() {
            const speechElement = document.getElementById('speechText');
            
            console.log(`üßπ clearSpeechBox() called`);
            
            // Stop any typing animation
            if (typingInterval) {
                clearInterval(typingInterval);
                typingInterval = null;
                console.log(`   Stopped typing animation`);
            }
            
            // Clear the text
            speechElement.textContent = '';
            console.log(`   Text cleared`);
        }

        // API integration - call this from your Python backend
        function updateFromBackend(data) {
            if (data.mood) {
                changeMood(data.mood);
            }
            if (data.response) {
                // Use typing animation if specified, otherwise instant update
                if (data.typing === true) {
                    const speed = data.typing_speed || 100; // Default 100ms per char
                    typeText(data.response, speed);
                } else {
                    updateSpeech(data.response);
                }
            }
            if (data.clear_response === true) {
                clearSpeechBox();
            }
        }

        const ws = new WebSocket('ws://localhost:8765');

        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            updateFromBackend(data);
        };

        ws.onopen = () => console.log("‚úÖ Connected to Python backend");
        ws.onclose = () => console.log("‚ùå Backend disconnected");


        // TEST MODE: Auto-toggle between idle and responding every 5 seconds
        let testMode = true;
        let isResponding = false;

        function toggleResponse() {
            if (testMode) {
                isResponding = !isResponding;
                const mood = isResponding ? 'responding' : 'idle';
                console.log(`\n‚è∞ [TEST] Timer triggered - Switching to: ${mood.toUpperCase()}`);
                changeMood(mood);
            }
        }

        // Run test every 5 seconds
        //const testInterval = setInterval(toggleResponse, 5000);
        //console.log('‚è±Ô∏è  Test interval started (every 5 seconds)');

        // Toggle test mode on click of cat display
        document.querySelector('.cat-display').addEventListener('click', () => {
            testMode = !testMode;
            console.log('\nüñ±Ô∏è  Clicked! Test mode:', testMode ? 'ON (auto-toggling)' : 'OFF');
            if (!testMode) {
                changeMood('idle'); // Return to idle when test mode off
            }
        });
    </script>
</body>
</html>